<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Matching peak patterns">

<title>The peak pattern puzzle – maxrf4u</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./peak-pattern-puzzle-solver.html" rel="next">
<link href="./hotmax.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-ae44de7e3b26b230a7801128389852ee.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="The peak pattern puzzle – maxrf4u">
<meta property="og:description" content="Matching peak patterns">
<meta property="og:image" content="https://fligt.github.io/maxrf4u/50_peak-pattern-puzzle_files/figure-html/cell-8-output-1.png">
<meta property="og:site_name" content="maxrf4u">
<meta property="og:image:height" content="529">
<meta property="og:image:width" content="819">
<meta name="twitter:title" content="The peak pattern puzzle – maxrf4u">
<meta name="twitter:description" content="Matching peak patterns">
<meta name="twitter:image" content="https://fligt.github.io/maxrf4u/50_peak-pattern-puzzle_files/figure-html/cell-8-output-1.png">
<meta name="twitter:image-height" content="529">
<meta name="twitter:image-width" content="819">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">maxrf4u</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/fligt/maxrf4u"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./peak-pattern-puzzle.html">The peak pattern puzzle</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome to maxrf4u</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./suzanna.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Meet Susanna</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./storage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Storage</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./calibration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Calibration</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spatial-verus-spectral.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial versus spectral</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hotmax.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hotmax spectra</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./peak-pattern-puzzle.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">The peak pattern puzzle</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./peak-pattern-puzzle-solver.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Solving the peak pattern puzzle</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./peakmaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distribution maps</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./speckles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Speckles</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./interactive-plotting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About interactive visualization using cloud storage</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./xphysics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">XRF physics - the gory details</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#exploring-the-peak-pattern-puzzle-for-each-hotmax-spectrum" id="toc-exploring-the-peak-pattern-puzzle-for-each-hotmax-spectrum" class="nav-link active" data-scroll-target="#exploring-the-peak-pattern-puzzle-for-each-hotmax-spectrum">Exploring the peak pattern puzzle for each hotmax spectrum</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions">FUNCTIONS</a>
  <ul class="collapse">
  <li><a href="#atomnums_from_elems" id="toc-atomnums_from_elems" class="nav-link" data-scroll-target="#atomnums_from_elems">atomnums_from_elems</a></li>
  <li><a href="#elems_from_atomnums" id="toc-elems_from_atomnums" class="nav-link" data-scroll-target="#elems_from_atomnums">elems_from_atomnums</a></li>
  <li><a href="#update_eoi" id="toc-update_eoi" class="nav-link" data-scroll-target="#update_eoi">update_eoi</a></li>
  <li><a href="#get_instrument_pattern" id="toc-get_instrument_pattern" class="nav-link" data-scroll-target="#get_instrument_pattern">get_instrument_pattern</a></li>
  <li><a href="#colorize" id="toc-colorize" class="nav-link" data-scroll-target="#colorize">colorize</a></li>
  <li><a href="#get_eoi_patterns" id="toc-get_eoi_patterns" class="nav-link" data-scroll-target="#get_eoi_patterns">get_eoi_patterns</a></li>
  <li><a href="#plot_patterns" id="toc-plot_patterns" class="nav-link" data-scroll-target="#plot_patterns">plot_patterns</a></li>
  <li><a href="#peak_pattern_atlas" id="toc-peak_pattern_atlas" class="nav-link" data-scroll-target="#peak_pattern_atlas">Peak_Pattern_Atlas</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/fligt/maxrf4u/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">The peak pattern puzzle</h1>
</div>

<div>
  <div class="description">
    Matching peak patterns
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<p>We now arrive at the central problem of MA-XRF analysis. Given a spectrum with some peaks, and given the theoretical emission peak patterns for different chemical elements, which chemical elements are present in the sample? This is what I call the peak pattern puzzle.</p>
<p>It is important to note that not all peaks are always due to the actual fluorescence emission of chemical elements present in the scanned object. Other peaks are generated by the instrument itself. And small peaks can also just be noise. Instrument peaks are common to all spectra. For example, the large peak observed in all spectra near zero energy is a result of the instrument detector physics. Other peaks above 18 keV are due emission and subsequent scattering of the rhodium anode present in the x-ray tube.</p>
<p>To simplify our current analysis let’s exclude the light elements and rare elements that we do not expect to detect in drawings. You can inspect the Elements Of Interest by importing <code>EOI</code>. Elements are excluded from the selection with the <code>#</code> sign in front of the chemical symbol. If needed you can add or remove elements by adding or removing the hash sign <code>#</code>.</p>
<div id="cell-4" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> maxrf4u <span class="im">import</span> EOI</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-5" class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>EOI <span class="op">=</span> [<span class="st">'#H'</span>, <span class="st">'#He'</span>, <span class="st">'#Li'</span>, <span class="st">'#Be'</span>, <span class="st">'#B'</span>, <span class="st">'#C'</span>, <span class="st">'N'</span>, <span class="st">'O'</span>, <span class="st">'F'</span>, <span class="st">'Ne'</span>, <span class="st">'Na'</span>, <span class="st">'Mg'</span>, <span class="st">'Al'</span>, <span class="st">'Si'</span>, <span class="st">'P'</span>, <span class="st">'S'</span>, <span class="st">'Cl'</span>, </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">'#Ar'</span>, <span class="st">'K'</span>, <span class="st">'Ca'</span>, <span class="st">'#Sc'</span>, <span class="st">'Ti'</span>, <span class="st">'V'</span>, <span class="st">'Cr'</span>, <span class="st">'Mn'</span>, <span class="st">'Fe'</span>, <span class="st">'Co'</span>, <span class="st">'Ni'</span>, <span class="st">'Cu'</span>, <span class="st">'Zn'</span>, <span class="st">'#Ga'</span>, <span class="st">'#Ge'</span>, <span class="st">'As'</span>, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">'#Se'</span>, <span class="st">'Br'</span>, <span class="st">'#Kr'</span>, <span class="st">'#Rb'</span>, <span class="st">'Sr'</span>, <span class="st">'#Y'</span>, <span class="st">'#Zr'</span>, <span class="st">'#Nb'</span>, <span class="st">'#Mo'</span>, <span class="st">'#Tc'</span>, <span class="st">'#Ru'</span>, <span class="st">'Rh'</span>, <span class="st">'#Pd'</span>, <span class="st">'Ag'</span>, <span class="st">'Cd'</span>, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">'#In'</span>, <span class="st">'Sn'</span>, <span class="st">'#Sb'</span>, <span class="st">'#Te'</span>, <span class="st">'I'</span>, <span class="st">'#Xe'</span>, <span class="st">'#Cs'</span>, <span class="st">'Ba'</span>, <span class="st">'#La'</span>, <span class="st">'#Hf'</span>, <span class="st">'#Ta'</span>, <span class="st">'#W'</span>, <span class="st">'#Re'</span>, <span class="st">'#Os'</span>, <span class="st">'#Ir'</span>, </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">'#Pt'</span>, <span class="st">'Au'</span>, <span class="st">'Hg'</span>, <span class="st">'#Tl'</span>, <span class="st">'Pb'</span>, <span class="st">'#Bi'</span>, <span class="st">'#Po'</span>, <span class="st">'#At'</span>, <span class="st">'#Rn'</span>, <span class="st">'#Fr'</span>, <span class="st">'#Ra'</span>, <span class="st">'#Ac'</span>, <span class="st">'#Rf'</span>, <span class="st">'#Db'</span>, <span class="st">'#Sg'</span>, </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>       <span class="st">'#Bh'</span>, <span class="st">'#Hs'</span>, <span class="st">'#Mt'</span>, <span class="st">'#Ds'</span>, <span class="st">'#Rg'</span>, <span class="st">'#Cn'</span>, <span class="st">'#Nh'</span>, <span class="st">'#Fl'</span>, <span class="st">'#Mc'</span>, <span class="st">'#Lv'</span>, <span class="st">'#Ts'</span>, <span class="st">'#Og'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now to start analyzing our peak pattern puzzle you first need to import and instantiate the <a href="https://fligt.github.io/maxrf4u/peak-pattern-puzzle.html#peak_pattern_atlas"><code>Peak_Pattern_Atlas()</code></a> class. You need to provide the <code>datastack_file=</code> option to include the instrument pattern in the atlas. Much should be said about the excitation energy <code>tube_keV</code>. However I can not elaborate on this topic now.</p>
<div id="cell-7" class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> maxrf4u <span class="im">import</span> Peak_Pattern_Atlas</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-8" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ppa <span class="op">=</span> Peak_Pattern_Atlas(elements_of_interest<span class="op">=</span>EOI, datastack_file<span class="op">=</span><span class="st">'RP-T-1898-A-3689.datastack'</span>, tube_keV<span class="op">=</span><span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Please wait while initializing peak pattern atlas...</code></pre>
</div>
</div>
<p>To activate interactive plotting you need to execute the notebook magic command:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib widget</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If it turns out that during your analysis you need to adjust your list of elements of interest you can include or exclude elements with the <code>Peak_Pattern_Atlas.update()</code> method.</p>
<div id="cell-12" class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ppa.update_eoi([<span class="st">'Zr'</span>, <span class="st">'Ar'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-13" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_patterns()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>In the previous section, out of one million spectra, we have cherry picked 22 hotmax spectra and within each spectrum detected potentially significant peaks exceeding the Poisson noise level. We can now proceed to solve the peak pattern puzzle for each hotmax spectrum. In other words, for each spectrum explain the presence of each significant (numbered) peak. Can we attribute a given peak to a specific chemical element, the instrument or noise?</p>
<p>In other words, we can start to ‘explain away’ all peaks. It is highly instructive to walk through some interesting hotmax spectra and see which element patterns explain the peak patterns that we observe. To do so you can use the <a href="https://fligt.github.io/maxrf4u/peak-pattern-puzzle.html#peak_pattern_atlas.plot_puzzle"><code>Peak_Pattern_Atlas.plot_puzzle()</code></a> method with the <code>select_elems=</code> keyword argument.</p>
<section id="exploring-the-peak-pattern-puzzle-for-each-hotmax-spectrum" class="level2">
<h2 class="anchored" data-anchor-id="exploring-the-peak-pattern-puzzle-for-each-hotmax-spectrum">Exploring the peak pattern puzzle for each hotmax spectrum</h2>
<div id="cell-17" class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_puzzle(<span class="dv">0</span>, select_elems<span class="op">=</span>[<span class="st">'Ca'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>In the puzzle plot for hotmax spectrum <strong>#0</strong> above, beside instrument peaks, all other peaks are rather small. I would say that only sub peak <strong>(4)</strong> can be explained as the <span class="math inline">\(K_{\alpha}\)</span> emission of calcium.</p>
<div id="cell-19" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_puzzle(<span class="dv">1</span>, select_elems<span class="op">=</span>[<span class="st">'O'</span>, <span class="st">'Ca'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-20" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_puzzle(<span class="dv">2</span>, select_elems<span class="op">=</span>[<span class="st">'Pb'</span>, <span class="st">'Fe'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>In hotmax spectrum <strong>#2</strong> above, one can see that sub peaks <strong>(0)</strong>, <strong>(1)</strong>, <strong>(3)</strong> and <strong>(6)</strong> can all be explained by the emission of lead (Pb). The tiny peaks <strong>(8)</strong> and <strong>(9)</strong> are explained by respectively iron (Fe) and calcium (Ca).</p>
<div id="cell-22" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_puzzle(<span class="dv">3</span>, select_elems<span class="op">=</span>[<span class="st">'Ca'</span>, <span class="st">'Fe'</span>, <span class="st">'Cl'</span>, <span class="st">'Zn'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>In hotmax spectrum <strong>#3</strong> sub peak <strong>(3)</strong> interestingly indicates the presence of chlorine (Cl). Furthermore we find evidence for calcium (Ca), iron (Fe), and perhaps zinc (Zn).</p>
<div id="cell-24" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_puzzle(<span class="dv">4</span>, select_elems<span class="op">=</span>[<span class="st">'Ca'</span>, <span class="st">'K'</span>, <span class="st">'S'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-25" class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_puzzle(<span class="dv">5</span>, select_elems<span class="op">=</span>[<span class="st">'Ca'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-26" class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_puzzle(<span class="dv">6</span>, select_elems<span class="op">=</span>[<span class="st">'Ca'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-15-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-27" class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_puzzle(<span class="dv">7</span>, select_elems<span class="op">=</span>[<span class="st">'Ca'</span>, <span class="st">'Ti'</span>, <span class="st">'Fe'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-28" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_puzzle(<span class="dv">8</span>, select_elems<span class="op">=</span>[<span class="st">'Ti'</span>, <span class="st">'Ba'</span>, <span class="st">'Fe'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-17-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-29" class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_puzzle(<span class="dv">9</span>, select_elems<span class="op">=</span>[<span class="st">'Mn'</span>, <span class="st">'Fe'</span>, <span class="st">'Ca'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-18-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-30" class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_puzzle(<span class="dv">10</span>, select_elems<span class="op">=</span>[<span class="st">'Fe'</span>, <span class="st">'Ca'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The tiny peak <strong>(6)</strong> in hotmax spectrum <strong>#10</strong> is clearly the escape peak for Fe located at 6.40 keV minus 1.74 keV.</p>
<div id="cell-32" class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_puzzle(<span class="dv">11</span>, select_elems<span class="op">=</span>[<span class="st">'Fe'</span>, <span class="st">'Ca'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-20-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-33" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_puzzle(<span class="dv">12</span>, select_elems<span class="op">=</span>[<span class="st">'Cu'</span>, <span class="st">'Zn'</span>, <span class="st">'Ca'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-21-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-34" class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_puzzle(<span class="dv">13</span>, select_elems<span class="op">=</span>[<span class="st">'Pb'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-35" class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_puzzle(<span class="dv">14</span>, select_elems<span class="op">=</span>[<span class="st">'Pb'</span>, <span class="st">'Fe'</span>, <span class="st">'Ca'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-23-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-36" class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>plt.close(<span class="st">'all'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-37" class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_puzzle(<span class="dv">15</span>, select_elems<span class="op">=</span>[])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-25-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-38" class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_puzzle(<span class="dv">16</span>, select_elems<span class="op">=</span>[<span class="st">'Pb'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-26-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-39" class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_puzzle(<span class="dv">17</span>, select_elems<span class="op">=</span>[])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-27-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-40" class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_puzzle(<span class="dv">18</span>, select_elems<span class="op">=</span>[<span class="st">'Pb'</span>, <span class="st">'Fe'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-28-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-41" class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_puzzle(<span class="dv">19</span>, select_elems<span class="op">=</span>[<span class="st">'Ca'</span>, <span class="st">'Zn'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-29-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-42" class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_puzzle(<span class="dv">20</span>, select_elems<span class="op">=</span>[<span class="st">'Ca'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-30-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-43" class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>ppa.plot_puzzle(<span class="dv">21</span>, select_elems<span class="op">=</span>[<span class="st">'Ca'</span>, <span class="st">'Cl'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-31-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-44" class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>ppa.contains_dict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{5: ['Ca'],
 0: ['Ca'],
 1: ['O', 'Ca'],
 2: ['Pb', 'Fe'],
 3: ['Ca', 'Fe', 'Cl', 'Zn'],
 4: ['Ca', 'K', 'S'],
 6: ['Ca'],
 7: ['Ca', 'Ti', 'Fe'],
 8: ['Ti', 'Ba', 'Fe'],
 9: ['Mn', 'Fe', 'Ca'],
 10: ['Fe', 'Ca'],
 11: ['Fe', 'Ca'],
 12: ['Cu', 'Zn', 'Ca'],
 13: ['Pb'],
 14: ['Pb', 'Fe', 'Ca'],
 15: [],
 16: ['Pb'],
 17: [],
 18: ['Pb', 'Fe'],
 19: ['Ca', 'Zn'],
 20: ['Ca'],
 21: ['Ca', 'Cl'],
 22: None}</code></pre>
</div>
</div>
<p>Ok, that is it. Let’s summarize which chemical elements we found in our MA-XRF data cube.</p>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<div id="cell-47" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> maxrf4u <span class="im">import</span> DataStack</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-48" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>ds <span class="op">=</span> DataStack(<span class="st">'RP-T-1898-A-3689.datastack'</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>x_keVs <span class="op">=</span> ds.read(<span class="st">'maxrf_energies'</span>) </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>y_max <span class="op">=</span> ds.read(<span class="st">'maxrf_maxspectrum'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-49" class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>found_elems <span class="op">=</span> [<span class="st">'S'</span>, <span class="st">'Ca'</span>, <span class="st">'K'</span>, <span class="st">'Cl'</span>, <span class="st">'Fe'</span>, <span class="st">'Mn'</span>, <span class="st">'Cu'</span>, <span class="st">'Zn'</span>, <span class="st">'Pb'</span>, <span class="st">'Ti'</span>, <span class="st">'Ba'</span>]</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>ppa.plot_patterns(select_elems<span class="op">=</span>found_elems)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="50_peak-pattern-puzzle_files/figure-html/cell-35-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Altogether the spectral data indicates that 11 chemical elements are present in the Susanna drawing: sulfur (S), chlorine (Cl), potassium (K), calcium (Ca), barium (Ba), titanium (Ti), manganese (Mn), iron (Fe), copper (Cu), zinc (Zn) and lead (Pb).</p>
<p>In the next section we will look into the spatial distribution of these elements…</p>
</section>
<section id="functions" class="level2">
<h2 class="anchored" data-anchor-id="functions">FUNCTIONS</h2>
<hr>
<p><a href="https://github.com/fligt/maxrf4u/blob/main/maxrf4u/peakpuzzle.py#L375" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="atomnums_from_elems" class="level3">
<h3 class="anchored" data-anchor-id="atomnums_from_elems">atomnums_from_elems</h3>
<blockquote class="blockquote">
<pre><code> atomnums_from_elems (elements)</code></pre>
</blockquote>
<p>*Convenience function to convert list of <code>elements</code> into atomic numbers.</p>
<p>Needed because zarr format 3 can not handle strings (yet).</p>
<p>Returns: atomnums*</p>
<hr>
<p><a href="https://github.com/fligt/maxrf4u/blob/main/maxrf4u/peakpuzzle.py#L363" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="elems_from_atomnums" class="level3">
<h3 class="anchored" data-anchor-id="elems_from_atomnums">elems_from_atomnums</h3>
<blockquote class="blockquote">
<pre><code> elems_from_atomnums (atomnum_list)</code></pre>
</blockquote>
<p>*Convenience function to convert integer list <code>atomnum_list</code> into chemical symbols.</p>
<p>Needed because zarr format 3 can not handle strings (yet).</p>
<p>Returns: elements*</p>
<hr>
<p><a href="https://github.com/fligt/maxrf4u/blob/main/maxrf4u/peakpuzzle.py#L341" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="update_eoi" class="level3">
<h3 class="anchored" data-anchor-id="update_eoi">update_eoi</h3>
<blockquote class="blockquote">
<pre><code> update_eoi (elements_of_interest, add_elems)</code></pre>
</blockquote>
<p>*Update <code>elements_of_interest</code> list for elements list <code>add_elems</code>.</p>
<p>For example: add_elems=[‘#Al’, ’Ga]*</p>
<hr>
<p><a href="https://github.com/fligt/maxrf4u/blob/main/maxrf4u/peakpuzzle.py#L304" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_instrument_pattern" class="level3">
<h3 class="anchored" data-anchor-id="get_instrument_pattern">get_instrument_pattern</h3>
<blockquote class="blockquote">
<pre><code> get_instrument_pattern (datastack_file)</code></pre>
</blockquote>
<p>*Generate instrument peak pattern.</p>
<p>Pattern dictionary contains strongest Rhodium anode emission peaks,<br>
their corresponding Compton shifted peaks, and a sensor peak</p>
<p>Returns: instrument_pattern_dict*</p>
<hr>
<p><a href="https://github.com/fligt/maxrf4u/blob/main/maxrf4u/peakpuzzle.py#L260" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="colorize" class="level3">
<h3 class="anchored" data-anchor-id="colorize">colorize</h3>
<blockquote class="blockquote">
<pre><code> colorize (elem)</code></pre>
</blockquote>
<p><em>Pick fixed color from nice color map for elements of interest.</em></p>
<hr>
<p><a href="https://github.com/fligt/maxrf4u/blob/main/maxrf4u/peakpuzzle.py#L209" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_eoi_patterns" class="level3">
<h3 class="anchored" data-anchor-id="get_eoi_patterns">get_eoi_patterns</h3>
<blockquote class="blockquote">
<pre><code> get_eoi_patterns (elements_of_interest, tube_keV=40)</code></pre>
</blockquote>
<p>*Create a list of xrf spectrum pattern dictionaries for all <code>elements_of_interest</code>.</p>
<p>Hashed (#) elements are excluded from the list.<br>
Returns <code>eoi_ptrns</code> dictionary list.*</p>
<hr>
<p><a href="https://github.com/fligt/maxrf4u/blob/main/maxrf4u/peakpuzzle.py#L105" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="plot_patterns" class="level3">
<h3 class="anchored" data-anchor-id="plot_patterns">plot_patterns</h3>
<blockquote class="blockquote">
<pre><code> plot_patterns (eoi_ptrns, select_elems=None, instrum_ptrn=None, ax=None)</code></pre>
</blockquote>
<p>*Wrapper function to plot overview of element patterns <code>elem_ptrns</code> and instrument patterns in axes <code>ax</code>.</p>
<p>Returns: <code>ax</code>*</p>
<hr>
<p><a href="https://github.com/fligt/maxrf4u/blob/main/maxrf4u/peakpuzzle.py#L27" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="peak_pattern_atlas" class="level3">
<h3 class="anchored" data-anchor-id="peak_pattern_atlas">Peak_Pattern_Atlas</h3>
<blockquote class="blockquote">
<pre><code> Peak_Pattern_Atlas (elements_of_interest=None, tube_keV=40,
                     datastack_file=None, verbose=True)</code></pre>
</blockquote>
<p><em>Compute atlas of peak patterns for all <code>elements_of_interest</code>.</em></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/fligt\.github\.io\/maxrf4u");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./hotmax.html" class="pagination-link" aria-label="Hotmax spectra">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Hotmax spectra</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./peak-pattern-puzzle-solver.html" class="pagination-link" aria-label="Solving the peak pattern puzzle">
        <span class="nav-page-text">Solving the peak pattern puzzle</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>2024 Rijkserfgoedlaboratorium Amsterdam | Made with nbdev</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/fligt/maxrf4u/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>